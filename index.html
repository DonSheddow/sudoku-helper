<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>


<head>
<meta charset="utf-8"/>

<style>

#sudoku-grid {
  display: inline-block;
  border: 3px solid black;
  margin: 2em;
}

#sudoku-grid span {
  display: inline-block;
}

.sudoku-block {
  border-collapse: collapse;
}

.sudoku-cell {
  border: 1px solid grey;
}

.sudoku-cell__input {
  border: none;
  text-align: center;
}

</style>

<script>

function isNumeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}

function serialize_sudoku() {
    var root = document.getElementById("sudoku-grid");
    var cells = document.getElementsByClassName("sudoku-cell__input");
    var rows = new Array(9).fill("");
    for (var i=0; i<cells.length; i++) {
        var index = 3*Math.floor(i/27) + (Math.floor(i/3) % 3);
        if (cells[i].value.trim() != "") {
            rows[index] += cells[i].value + ',';
        }
        else {
            rows[index] += "_" + ',';
        }
    }
    
    for (var i=0; i<rows.length; i++){
        rows[i] = rows[i].substring(0, rows[i].length-1);
    }
    
    return JSON.stringify(rows);
}

function create_sudoku_block() {
    var root = document.createElement("table");
    root.classList.add("sudoku-block");
    for (var i=0; i<3; i++) {
        var row = document.createElement("tr");
        for (var j=0; j<3; j++) {
            var column = document.createElement("td");
            column.classList.add("sudoku-cell");
            var input = document.createElement("input");
            input.classList.add("sudoku-cell__input");
            input.type = "text";
            input.size = "1";
            column.appendChild(input);
            row.appendChild(column);
        }
        root.appendChild(row);
    }
    return root;
}

function create_sudoku_grid() {
    var root = document.getElementById("sudoku-grid");
    for (var i=0; i<3; i++) {
        var blockrow = document.createElement("div");
        for (var j=0; j<3; j++) {
            var block = document.createElement("span");
            block.appendChild(create_sudoku_block());
            blockrow.appendChild(block);
        }
        root.appendChild(blockrow);
    }
}

function send_msg() {
//    var msg = document.getElementById("msg-input").value;
    var msg = serialize_sudoku();
    socket.send(msg);
}

var socket = new WebSocket("ws://localhost:3012");
socket.onmessage = function (event) {
    document.getElementById("message-box").innerHTML = event.data;
}

</script>

</head>


<body onload="create_sudoku_grid()">

<h3 id="message-box"></h3>

<input id="msg-input" type="text"></input>
<button onclick="send_msg()">Submit</button>

<div>
<div id="sudoku-grid">
</div>
</div>

</body>

</html>
